<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Moodly</title>
    <link rel="icon" href="moodly.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #ff6b6b, #ffd93d, #6a5acd);
        margin: 0;
        padding: 0;
        /* Hapus ini: display, justify-content, align-items */
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Container utama agar tetap di tengah horizontal */
      .main-container {
        display: flex;
        flex-wrap: wrap;
        max-width: 1000px;
        width: 100%;
        margin: 20px auto; /* auto horizontal centering */
        gap: 20px;
        flex: 1; /* agar footer tetap di bawah */
      }

      .box {
        background: #fff;
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 300px;
        box-sizing: border-box;
        position: relative;
      }
      .logo {
        display: block;
        width: 80px;
        margin: 0 auto 10px auto;
      }
      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 5px;
      }
      p {
        text-align: center;
        margin: 0 0 20px 0;
        color: #555;
      }
      .mood-container {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        margin-bottom: 20px;
        position: relative;
      }
      .mood {
        font-size: 40px;
        cursor: pointer;
        transition: transform 0.2s;
        position: relative;
        margin-bottom: 10px;
      }
      .mood:hover {
        transform: scale(1.3);
      }
      .mood-label {
        position: absolute;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        background: #2c68ff;
        color: #fff;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 14px;
        display: none;
        white-space: nowrap;
      }
      .show-label {
        display: block;
      }
      textarea {
        width: 100%;
        height: 60px;
        margin-bottom: 10px;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #ccc;
        resize: none;
        font-family: "Poppins", sans-serif;
        box-sizing: border-box;
      }
      button {
        width: 100%;
        padding: 10px;
        border: none;
        background-color: #2c68ff;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
        transition: background-color 0.2s;
      }
      button:hover {
        background-color: #0048ff;
      }
      .history,
      .stats {
        margin-top: 20px;
      }
      .history-item {
        background: #f9f9f9;
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }
      .history-item span:last-child {
        word-break: break-word;
        margin-top: 5px;
      }
      .alert-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #2c68ff;
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        display: none;
        z-index: 9999;
        font-weight: 600;
      }
      .emoji-fly {
        position: absolute;
        font-size: 24px;
        animation: flyUp 1s forwards;
        pointer-events: none;
      }
      @keyframes flyUp {
        0% {
          opacity: 1;
          transform: translateY(0);
        }
        100% {
          opacity: 0;
          transform: translateY(-50px);
        }
      }
      @media (max-width: 800px) {
        .main-container {
          flex-direction: column;
        }
        textarea {
          height: 80px;
        }
      }
      .streak {
        text-align: center;
        font-weight: 600;
        margin-bottom: 10px;
        color: #2c68ff;
      }
      .quote {
        text-align: center;
        font-style: italic;
        margin-bottom: 10px;
        color: #555;
      }
      .footer {
        text-align: center;
        padding: 20px 0;
        font-size: 12px;
        color: #ffffff;
      }
    </style>
  </head>
  <body>
    <div class="alert-box" id="alertBox"></div>
    <div class="main-container">
      <!-- Input Mood & Catatan -->
      <div class="box">
        <img src="moodly.png" alt="Moodly Logo" class="logo" />
        <h1>Moodly</h1>
        <p>Pilih mood hari ini:</p>
        <div class="streak" id="streakText"></div>
        <div class="quote" id="quoteText"></div>
        <div class="mood-container">
          <div class="mood" data-mood="Senang" data-emoji="üòÑ">
            üòÑ<span class="mood-label">Senang</span>
          </div>
          <div class="mood" data-mood="Biasa" data-emoji="üòê">
            üòê<span class="mood-label">Biasa</span>
          </div>
          <div class="mood" data-mood="Sedih" data-emoji="üò¢">
            üò¢<span class="mood-label">Sedih</span>
          </div>
          <div class="mood" data-mood="Marah" data-emoji="üò°">
            üò°<span class="mood-label">Marah</span>
          </div>
          <div class="mood" data-mood="Lelah" data-emoji="üò¥">
            üò¥<span class="mood-label">Lelah</span>
          </div>
        </div>
        <textarea id="note" placeholder="Tulis catatan hari ini..."></textarea>
        <button id="saveBtn">Simpan Mood</button>
        <!-- <button id="resetBtn" style="margin-top:10px;background:#f44336;">Reset Data</button> -->
      </div>

      <!-- Riwayat & Statistik -->
      <div class="box">
        <div class="history">
          <h2>Riwayat Mood</h2>
          <div id="historyList"></div>
        </div>
        <div class="stats">
          <h2>Statistik Mood</h2>
          <canvas id="statsPie" width="300" height="300"></canvas>
        </div>
      </div>
    </div>
    <footer class="footer">
      Copyright ¬© Moodly - Ananda David Saputa.
    </footer>

    <script>
      const moods = document.querySelectorAll(".mood");
      const saveBtn = document.getElementById("saveBtn");
      const resetBtn = document.getElementById("resetBtn");
      const noteInput = document.getElementById("note");
      const historyList = document.getElementById("historyList");
      const statsPie = document.getElementById("statsPie");
      const alertBox = document.getElementById("alertBox");
      const streakText = document.getElementById("streakText");
      const quoteText = document.getElementById("quoteText");
      let selectedMood = null;
      let selectedEmoji = null;
      const emojiMap = {
        Senang: "üòÑ",
        Biasa: "üòê",
        Sedih: "üò¢",
        Marah: "üò°",
        Lelah: "üò¥",
      };
      const colors = {
        Senang: "#00BFFF",
        Biasa: "#FFA500",
        Sedih: "#1E90FF",
        Marah: "#FF4500",
        Lelah: "#8A2BE2",
      };
      const quotes = [
        "Tetap semangat!",
        "Hari ini penuh warna üåà",
        "Senyum dulu üòÅ",
        "Nikmati prosesnya",
        "Kamu hebat!",
      ];

      // Hover label & pilih mood
      moods.forEach((m) => {
        const label = m.querySelector(".mood-label");
        m.addEventListener("mouseenter", () =>
          label.classList.add("show-label")
        );
        m.addEventListener("mouseleave", () =>
          label.classList.remove("show-label")
        );
        m.addEventListener("click", (e) => {
          selectedMood = m.dataset.mood;
          selectedEmoji = m.dataset.emoji;
          moods.forEach((x) => (x.style.transform = "scale(1)"));
          m.style.transform = "scale(1.3)";
          // emoji fly
          const fly = document.createElement("div");
          fly.textContent = selectedEmoji;
          fly.className = "emoji-fly";
          document.body.appendChild(fly);
          const rect = m.getBoundingClientRect();
          fly.style.left = rect.left + rect.width / 2 + "px";
          fly.style.top = rect.top + "px";
          setTimeout(() => fly.remove(), 1000);
        });
      });

      // Alert
      function showAlert(msg) {
        alertBox.textContent = msg;
        alertBox.style.display = "block";
        setTimeout(() => {
          alertBox.style.display = "none";
        }, 2000);
      }

      // Load history & stats
      function loadHistory() {
        const data = JSON.parse(localStorage.getItem("moodlyData")) || [];
        historyList.innerHTML = "";
        let today = new Date().toISOString().split("T")[0];
        let todayExists = data.find((d) => d.date.split("T")[0] === today);
        saveBtn.textContent = todayExists ? "Update Mood" : "Simpan Mood";

        // Streak
        let streak = 0;
        data.sort((a, b) => new Date(a.date) - new Date(b.date));
        for (let i = data.length - 1; i >= 0; i--) {
          const dateDiff =
            (new Date(today) - new Date(data[i].date)) / (1000 * 60 * 60 * 24);
          if (dateDiff === streak) streak++;
          else break;
        }
        streakText.textContent =
          streak > 0 ? `Streak ${streak} hari berturut-turut` : "";

        // Quote
        quoteText.textContent =
          quotes[Math.floor(Math.random() * quotes.length)];

        data.forEach((item) => {
          const div = document.createElement("div");
          div.className = "history-item";
          const dateStr = new Date(item.date).toLocaleDateString("id-ID", {
            day: "numeric",
            month: "long",
            year: "numeric",
          });
          div.innerHTML = `<span>${emojiMap[item.mood]} ${
            item.mood
          } - ${dateStr}</span><span>${item.note || ""}</span>`;
          historyList.appendChild(div);
        });
        updateStats(data);
      }

      // Pie chart
      function updateStats(data) {
        const ctx = statsPie.getContext("2d");
        ctx.clearRect(0, 0, statsPie.width, statsPie.height);
        const count = {};
        data.forEach(
          (item) => (count[item.mood] = (count[item.mood] || 0) + 1)
        );
        const total = data.length || 1;
        let start = 0;
        for (let mood in count) {
          if (count[mood] <= 0) continue;
          const percent = count[mood] / total;
          const end = start + percent * 2 * Math.PI;
          ctx.beginPath();
          ctx.moveTo(statsPie.width / 2, statsPie.height / 2);
          ctx.arc(statsPie.width / 2, statsPie.height / 2, 120, start, end);
          ctx.closePath();
          ctx.fillStyle = colors[mood];
          ctx.fill();
          // label
          const mid = (start + end) / 2;
          ctx.fillStyle = "#fff";
          ctx.font = "14px Poppins";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(
            `${emojiMap[mood]} ${Math.round(percent * 100)}%`,
            statsPie.width / 2 + Math.cos(mid) * 70,
            statsPie.height / 2 + Math.sin(mid) * 70
          );
          start = end;
        }
      }

      // Save mood
      saveBtn.addEventListener("click", () => {
        if (!selectedMood) {
          showAlert("Pilih mood dulu!");
          return;
        }
        const note = noteInput.value.trim();
        const today = new Date().toISOString().split("T")[0];
        let data = JSON.parse(localStorage.getItem("moodlyData")) || [];
        const idx = data.findIndex((d) => d.date.split("T")[0] === today);
        if (idx >= 0) {
          data[idx].mood = selectedMood;
          data[idx].note = note;
          showAlert("Mood hari ini diperbarui!");
        } else {
          data.push({
            mood: selectedMood,
            note,
            date: new Date().toISOString(),
          });
          showAlert("Mood hari ini tersimpan!");
        }
        localStorage.setItem("moodlyData", JSON.stringify(data));
        noteInput.value = "";
        selectedMood = null;
        selectedEmoji = null;
        moods.forEach((x) => (x.style.transform = "scale(1)"));
        loadHistory();
      });

      // Reset
      // resetBtn.addEventListener("click",()=>{
      //   if(confirm("Hapus semua data mood?")){
      //     localStorage.removeItem("moodlyData");
      //     showAlert("Semua data mood terhapus!");
      //     loadHistory();
      //   }
      // });

      // Dummy data awal
      // if(!localStorage.getItem("moodlyData")){
      //   const testData=[];
      //   const moodsArr=["Senang","Biasa","Sedih","Marah","Lelah"];
      //   for(let i=1;i<=5;i++){
      //     const mood=moodsArr[Math.floor(Math.random()*moodsArr.length)];
      //     testData.push({mood,note:`Catatan contoh ${i}`,date:new Date(2025,8,i).toISOString()});
      //   }
      //   localStorage.setItem("moodlyData",JSON.stringify(testData));
      // }

      loadHistory();
    </script>
  </body>
</html>
